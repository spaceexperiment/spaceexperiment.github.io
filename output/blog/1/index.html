<!DOCTYPE html>
<html lang="en">
<head>
          <title>jibreel</title>
        <meta charset="utf-8" />
        <meta name="description" content="A blog on Web-Development and Python">
        <link rel="stylesheet" href="http://jibreel.me/theme/css/index.css" />

        <link href="http://jibreel.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="jibreel Full Atom Feed" />




</head>

<body id="index">

    <div class="body-wrapper">
<script type="text/javascript">
    function toggleMenu(){
        var nav = document.getElementById('menu');
        var hamburger = document.getElementsByClassName('hamburger')[0];

        var display = nav.currentStyle ? nav.currentStyle.display :
                                      getComputedStyle(nav, null).display;
        if (display === 'none'){
            nav.style.display = 'block';
            hamburger.style.left = '260px';
        } else {
            nav.style.display = 'none';
            hamburger.style.left = '10px';
        }
    }
</script>

<button class="hamburger" onclick="toggleMenu()">â˜°</button>

<nav id="menu">
    <aside>

        <h3>A blog on Web-Development, Python and Stuff</h3>

        <div class="profile"><img width="150", height="150" src="http://jibreel.me/theme/img/me.jpg" alt="profile image"></div>

        <h4>Freelance web-developer</h4>


        <div class="network">
            <a href="https://twitter.com/jibbo">
                <img src="http://jibreel.me/theme/icon/Twitter.png" width="33px" height="33px" alt="Twitter">
            </a>

            <a href="https://www.linkedin.com/in/jibreel">
                <img src="http://jibreel.me/theme/icon/LinkedIn.png" width="33px" height="33px" alt="LinkdIn">
            </a>

            <a href="https://www.facebook.com/jibreel">
                <img src="http://jibreel.me/theme/icon/Facebook.png" width="33px" height="33px" alt="Facebook">
            </a>

            <a href="https://plus.google.com/u/0/+jibreeltozlok/posts">
                <img src="http://jibreel.me/theme/icon/GooglePlus.png" width="33px" height="33px" alt="GooglePlus">
            </a>

            <a href="skype:jibbo1988?add">
                <img src="http://jibreel.me/theme/icon/Skype.png" width="33px" height="33px" alt="Skype">
            </a>
        </div>

        <a class="button" href="/">home</a>
            <a class="button " href="http://jibreel.me/about-me/">About me</a>
    </aside>

    </ul>
</nav>
<section id="content" class="body">
    <header>
        <h2 class="entry-title">
              <a title="Permalink to Simple CRUD-like admin interface with Flask and WTForm"
                 href="http://jibreel.me/blog/1/"
                 rel="bookmark">
                     Simple CRUD-like admin interface with Flask and WTForm
               </a>
         </h2>
    </header>

    <footer class="post-info">
        <time class="published" datetime="2014-08-02T07:36:00+03:00">
            Sat 02 August 2014
        </time>

    </footer>

    <div class="article-wrapper">
        <article>
            <p>Without a doubt, many times over the course as a web developer, you will
sooner or later need to create admin interface for a specific project
that you have been working on.</p>
<p>One of the most common use case for an admin interface is to edit data
for your models.</p>
<p>To be able to create a new object, (like a blog post), edit an existing
object, delete it, or simply just to view it's content.</p>
<p>CRUD stands for <strong>CREATE</strong>, <strong>READ</strong>, <strong>UPDATE</strong>, <strong>DELETE</strong>.</p>
<p>When bulding REST API, the <strong>UPDATE</strong> and <strong>DELETE</strong> part is probably used with
the HTTP methods <strong>PUT</strong>, <strong>DELETE</strong>.</p>
<p>However, for a web page, we don't usually deal with <strong>PUT</strong> and <strong>DELETE</strong>, rather, just
<strong>GET</strong> and <strong>POST</strong>,</p>
<p>so we only have that to worry about, however we still have to implement
a full CRUD for our model in the admin interface.</p>
<p>There is already pre-packaged Admin interface extensions for different
frameworks, Django for example has a full blown admin app already
included without installing anything external, Flask has several
extensions you can install, the two most popular is probably Flask-Admin
and Flask-SuperAdmin.</p>
<p>The former is simple to use and allow for great flexibility to customize
it, the later is a "supervitamined fork of the Flask-Admin" as they put
it.</p>
<p>One thing all these extensions share in common is the fact that you can
creat a CRUD operation from any given model, built from some of the
popular ORMs(object relational model), like Django's ORM or the
SQLAlchemy's ORM which is framework independent.</p>
<p>In a nutshell you provide your model, it builds the CRUD operations and
interface for you.</p>
<p>Simple enough, however the more abstraction you have to deal with for
any given projects the harder it become to customize it, you will have
to look deep in the documentation to find a clue to a certain
customization to modify it and so on.</p>
<p>Granted they give you incredible speed to build in Admin interface, you
barely have to do a few tweaks and that's it, but the more you want to
customize it the more annoying it becomes to work with, so, many times,
you are better of with creating your own Admin interface.</p>
<p>For simple projects it's easy enough to hard code the admin interface,
however the more apps and models your projects have it's nearly
imposible to just hardcode every single CRUD operation.</p>
<p>In this small tutorial, we will go through on how to build a simple CRUD
object from scratch in flask that will work somehow similar to already
existing extensions (except much simpler with less abstraction), that
you can tailer for you own need for a any given project.</p>
<p>The main purpose for this is that you can easy dig in to the code and
change it's behavier radicaly if needed, without going through
abstraction layers.</p>
<p>Of cource we will build on some existing technologies like the perfect
WTForm to build our forms, SQLAlchemy to create our model, and flask for
it's simplicity and power.</p>
<p>We shall use this simple blog app to build an admin interface for.</p>
<p>Be sure you are runing a virtual environment so that you don't polute
you system by installing packages system wide, if you don't have it
already installed<a href="http://docs.python-guide.org/en/latest/dev/virtualenvs/">read this for
instructions</a>.</p>
<p>Create a folder called project, inside it app, and another folder inside
of it and call it admin</p>
<div class="highlight"><pre><span class="c"># all the dependencies you need</span>

<span class="n">pip</span> <span class="n">install</span> <span class="n">flask</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">wtform</span> <span class="c"># for the form creation</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">flask</span><span class="o">-</span><span class="n">sqlalchemy</span> <span class="c"># for the database</span>

<span class="c"># you can install them all with one line</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">flask</span><span class="p">,</span> <span class="n">wtform</span><span class="p">,</span> <span class="n">flask</span><span class="o">-</span><span class="n">sqlalchemy</span>
</pre></div>


<div class="highlight"><pre><span class="c"># project/app/__init__.py</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span>
<span class="kn">from</span> <span class="nn">flask.ext.sqlalchemy</span> <span class="kn">import</span> <span class="n">SQLAlchemy</span>


<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="s">&#39;app&#39;</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">DEBUG</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">SQLALCHEMY_DATABASE_URI</span><span class="o">=</span><span class="s">&#39;sqlite:///../database.db&#39;</span>
    <span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&#39;Blog be here&#39;</span>


<span class="c"># project/run.py</span>
<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">app</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>In the terminal <code class="python">project/ ~$ python run.py</code>
should run the development server</p>
<p>Now lets create a relativeley simple model.</p>
<p>create an empty <code>__init__.py</code> file in project/app/admin/</p>
<div class="highlight"><pre><span class="c"># project/app/admin/models.py</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">db</span>


<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c"># pretty self explanotory</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Text</span><span class="p">())</span>

    <span class="n">created_on</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">updated_on</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">,</span>
                                          <span class="n">onupdate</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">body</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&lt;Blogpost - {}&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
</pre></div>


<p>Your structure should now look like this.</p>
<div class="highlight"><pre>project
â”œâ”€â”€ app
â”‚   â”œâ”€â”€ admin
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â””â”€â”€ __init__.py
â””â”€â”€ run.py
</pre></div>


<p>We have to initiate the database for the models that we have just
created Open a python shell from the project folder.</p>
<div class="highlight"><pre><span class="c"># the sqlalchemy db object</span>
<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span>

<span class="c"># we have to import the models so that sqlalchemy can detect them and create the db</span>
<span class="c"># how else would it know what to create ?</span>
<span class="kn">from</span> <span class="nn">app.admin.models</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c"># creates the database</span>
<span class="n">db</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>

<span class="c"># after the last command you should now be able to see database.db file</span>
<span class="c"># in the project folder</span>
</pre></div>


<p>Ok, we now have a blog app, with the models created.</p>
<p>we have to actualy create some blog posts, and what better way to do
that other than through an admin interface? Let's get to business</p>
<p>Let's think for a moment on how we want the urls to be.</p>
<div class="highlight"><pre>/admin/blog/  [GET] return a list of all blog posts

/admin/blog/  [POST] create a new the post

/admin/blog/4/  [GET] display the form of a post by it&#39;s id

/admin/blog/4/  [POST] should update the post of that id

/admin/blog/new/  [GET] display an empty form based on the model

/admin/blog/delete/4/  [GET] delete any given post by id
</pre></div>


<h3>edit: here i used <strong>get</strong> method for delete, it should be <strong>POST</strong></h3>
<p>Lets get started by building them one by one, utilize a Blueprint for
the admin page, so that every view we build inside the admin.py becomes
url prefixed with /admin/.</p>
<div class="highlight"><pre><span class="c"># project/app/admin/admin.py</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">abort</span><span class="p">,</span> \
                  <span class="n">render_template</span>


<span class="n">admin</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s">&#39;admin&#39;</span><span class="p">,</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="s">&#39;templates&#39;</span><span class="p">)</span>



<span class="c"># project/app/admin/__init__.py</span>

<span class="c"># so that we can import anything from admin folder</span>
<span class="c"># without the extra admin syntax</span>
<span class="kn">from</span> <span class="nn">admin</span> <span class="kn">import</span> <span class="o">*</span>



<span class="c"># project/__init__.py</span>

<span class="c"># bellow line &quot;db = SQLAlchemy(app)&quot;</span>
<span class="kn">from</span> <span class="nn">admin</span> <span class="kn">import</span> <span class="n">admin</span> <span class="c"># the Blueprint instance that we created</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="s">&#39;/admin&#39;</span><span class="p">)</span>
</pre></div>


<p>Blueprints are great way to split apps in different folders like in this
case the admin folder inside of of we place every thing relevant to the
admin interface that we are creating.</p>
<p>So if you have a very large application creating it thus would make it
manageable and modular.</p>
<p>Now we are ready for the CRUD operations.</p>
<div class="highlight"><pre><span class="c"># project/app/admin/admin.py</span>

<span class="c"># We make use of flask Methodview</span>
<span class="c"># it&#39;s a class that we can inherit from and define a get and post methods</span>
<span class="c"># inside of it and the url dispatcher will automaticly link to relevant http method</span>
<span class="kn">from</span> <span class="nn">flask.views</span> <span class="kn">import</span> <span class="n">MethodView</span>

<span class="c"># the model to we want to administer</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Blog</span>

<span class="c"># our crud class that we will continiously expand on</span>
<span class="c"># and later use for any given model that we define</span>
<span class="k">class</span> <span class="nc">CRUDView</span><span class="p">(</span><span class="n">MethodView</span><span class="p">):</span>
    <span class="c"># default template that we will use to display a list</span>
    <span class="c"># of all items in a model</span>
    <span class="n">list_template</span> <span class="o">=</span> <span class="s">&#39;admin/list_view.html&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">list_template</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoint</span>
        <span class="c"># so we can generate a url relevant to this</span>
        <span class="c"># endpoint, for example if we utilize this CRUD object</span>
        <span class="c"># to enpoint comments the path generated will be</span>
        <span class="c"># /admin/comments/</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s">&#39;.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">list_template</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_template</span> <span class="o">=</span> <span class="n">list_template</span>


    <span class="c"># all GET methods will link to this function</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">():</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="n">list_template</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>


<span class="c"># this turns the class to a function that flask can use for requests</span>
<span class="c"># the argument it takes is the endpoint that you can call in url_for()</span>
<span class="c"># since we are using a blueprint called admin the endpoint becomes</span>
<span class="c"># in this case &#39;admin.blog&#39; or simply &#39;.blog&#39;</span>
<span class="c"># the &#39;.&#39; links to the current app(which is &#39;admin&#39;)</span>
<span class="n">view</span> <span class="o">=</span> <span class="n">CRUDView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s">&#39;blog&#39;</span><span class="p">)</span>

<span class="c"># now we just add the url rule</span>
<span class="n">admin</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s">&#39;/blog/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;POST&#39;</span><span class="p">])</span>
</pre></div>


<p>If we try to run <code>python run.py</code>
it wouldn't work, becaouse we havent created a template yet :(</p>
<p>The template bellow simply creates a <code class="blue">CREATE</code> button
then loops over every item in the obj and displays it along with a <code class="red">DELETE</code> button</p>
<div class="highlight"><pre><span class="c">&lt;!-- project/app/admin/templates/admin/listview.html --&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Admin<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;http://yui.yahooapis.com/pure/0.5.0/pure-min.css&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style&gt;</span>
        <span class="nc">.button</span> <span class="p">{</span>
          <span class="k">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
          <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">4px</span><span class="p">;</span>
          <span class="k">text-shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">1px</span> <span class="m">1px</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">.</span><span class="m">2</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nc">.button.red</span> <span class="p">{</span>
          <span class="k">background</span><span class="o">:</span> <span class="m">#ca3c3c</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.button.blue</span> <span class="p">{</span>
          <span class="k">background</span><span class="o">:</span> <span class="m">#3caeca</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.listview</span> <span class="o">&gt;</span> <span class="nt">a</span> <span class="p">{</span>
          <span class="k">margin</span><span class="o">:</span> <span class="m">10px</span> <span class="m">0</span> <span class="m">10px</span> <span class="m">20px</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.listview</span> <span class="nc">.pure-g</span> <span class="p">{</span>
          <span class="k">margin</span><span class="o">:</span> <span class="m">2px</span> <span class="k">auto</span><span class="p">;</span>
          <span class="k">padding</span><span class="o">:</span> <span class="m">10px</span> <span class="m">0</span> <span class="m">10px</span> <span class="m">20px</span><span class="p">;</span>
          <span class="k">background</span><span class="o">:</span> <span class="m">#f4f6ff</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.listview</span> <span class="nc">.pure-u</span> <span class="p">{</span>
          <span class="k">overflow</span><span class="o">:</span> <span class="k">hidden</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;listview&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button pure-button-primary&quot;</span> <span class="na">href=</span><span class="s">&quot;{{path + &#39;new&#39;}}&quot;</span><span class="nt">&gt;</span>Create new<span class="nt">&lt;/a&gt;</span>

    {% for item in obj %}
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;pure-g&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;pure-u-2-24&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button pure-button-primary button red&quot;</span> <span class="na">href=</span><span class="s">&quot;{{path +&#39;delete/&#39;+ item.id|string}}&quot;</span><span class="nt">&gt;</span>delete<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;pure-u&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button pure-button-primary button blue&quot;</span> <span class="na">href=</span><span class="s">&quot;{{path + item.id|string}}&quot;</span><span class="nt">&gt;</span>{{item}}<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    {% endfor %}
    <span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


<p><code>python run.py</code> renders the template and works as expected.
But wait, all i see is a "Create New" button :(</p>
<p>Well that's because our database is still empty.
we will have to create some post to be able to see them, you could do so
in the command line.</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span>
<span class="kn">from</span> <span class="nn">app.admin.models</span> <span class="kn">import</span> <span class="n">Blog</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="s">&#39;my first post&#39;</span><span class="p">,</span> <span class="s">&#39;some looooong body&#39;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="s">&#39;my second post&#39;</span><span class="p">,</span> <span class="s">&#39;some short body&#39;</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="s">&#39;my third post&#39;</span><span class="p">,</span> <span class="s">&#39;bla bla bla&#39;</span><span class="p">)</span>

<span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>


<p>Hit refresh and you should see a nice list of all the blog posts.
Since We want to be able to create post in the admin interface.
lets make a new url <code class="yellow">/admin/blog/blog\_id/</code>
we should be able to do a <strong>GET</strong> method and retrieve a blog form.</p>
<div class="highlight"><pre><span class="c"># project/app/admin/admin.py</span>

<span class="c"># add these two imports</span>
<span class="kn">from</span> <span class="nn">wtforms.ext.sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">model_form</span>
<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span>


<span class="c"># add this new url rule bellow the previes rule</span>
<span class="n">admin</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s">&#39;/blog/&lt;int:obj_id&gt;/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>
                   <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;POST&#39;</span><span class="p">])</span>


<span class="c"># in the CRUDView add this bellow list_template</span>
<span class="n">detail_template</span> <span class="o">=</span> <span class="s">&#39;admin/detailview.html&#39;</span>

<span class="c"># modify our get method to look like this</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_id</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">obj_id</span><span class="p">:</span>
        <span class="c"># this creates the form fields base on the model</span>
        <span class="c"># so we don&#39;t have to do them one by one</span>
        <span class="n">ObjForm</span> <span class="o">=</span> <span class="n">model_form</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj_id</span><span class="p">)</span>
        <span class="c"># populate the form with our blog data</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ObjForm</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
        <span class="c"># action is the url that we will later use</span>
        <span class="c"># to do post, the same url in this case</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">detail_template</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span>
                               <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">)</span>


    <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">created_on</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_template</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</pre></div>


<p>The template of course...</p>
<div class="highlight"><pre><span class="c">&lt;!-- project/app/admin/templates/admin/detailview.html  --&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Admin<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;http://yui.yahooapis.com/pure/0.5.0/pure-min.css&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style&gt;</span>
        <span class="nc">.button</span> <span class="p">{</span>
          <span class="k">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
          <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">4px</span><span class="p">;</span>
          <span class="k">text-shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">1px</span> <span class="m">1px</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">.</span><span class="m">2</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nc">.button.red</span> <span class="p">{</span>
          <span class="k">background</span><span class="o">:</span> <span class="m">#ca3c3c</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.button.blue</span> <span class="p">{</span>
          <span class="k">background</span><span class="o">:</span> <span class="m">#3caeca</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="p">{</span>
          <span class="k">width</span><span class="o">:</span> <span class="m">90%</span><span class="p">;</span>
          <span class="k">margin</span><span class="o">:</span> <span class="m">40px</span> <span class="k">auto</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">legend</span> <span class="p">{</span>
          <span class="k">color</span><span class="o">:</span> <span class="m">#6b6b6b</span><span class="p">;</span>
          <span class="k">font-size</span><span class="o">:</span> <span class="m">1.2em</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">label</span> <span class="p">{</span>
          <span class="k">margin-top</span><span class="o">:</span> <span class="m">30px</span><span class="p">;</span>
          <span class="k">color</span><span class="o">:</span> <span class="m">#a5a5a5</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">textarea</span> <span class="p">{</span>
          <span class="k">min-height</span><span class="o">:</span> <span class="m">200px</span><span class="p">;</span>
          <span class="k">padding</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">input</span><span class="o">,</span> <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">select</span><span class="o">,</span> <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">textarea</span> <span class="p">{</span>
          <span class="k">width</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="s2">&quot;checkbox&quot;</span><span class="o">]</span> <span class="p">{</span>
          <span class="k">width</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">button</span> <span class="p">{</span>
          <span class="k">margin</span><span class="o">:</span> <span class="m">30px</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;item-form&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">&quot;pure-form pure-form-stacked&quot;</span>
              <span class="na">action=</span><span class="s">&quot;{{action}}&quot;</span>
              <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>

            <span class="nt">&lt;fieldset&gt;</span>
                <span class="nt">&lt;legend&gt;</span>Item View<span class="nt">&lt;/legend&gt;</span>

                {% for field in form %}

                    {{field.label()}}
                    {{field(class=&quot;pure-input&quot;)}}

                {% endfor %}

                <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">class=</span><span class="s">&quot;pure-button pure-button-primary pure-input-1-4&quot;</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>

                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button pure-button-primary button red&quot;</span> <span class="na">href=</span><span class="s">&quot;{{ path +&#39;delete/&#39;+ action.split(&#39;/&#39;)[-2]}}&quot;</span><span class="nt">&gt;</span>delete<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;/fieldset&gt;</span>

        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


<p>This is how it should look like</p>
<p><a href="https://s3-us-west-2.amazonaws.com/jibreel/blog/list_blog_1.png"><img alt="screenshot" src="https://s3-us-west-2.amazonaws.com/jibreel/blog/list_blog_1.png" /></a></p>
<p>Clicking on ony of the blog post in the list should now display you a
nice form with all the data.</p>
<p>We have done the GET method, now for the POST part, where we actually
modify the form and submit it.</p>
<div class="highlight"><pre><span class="c"># project/app/admin/admin.py</span>

<span class="c"># in CRUDView</span>

<span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_id</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="c"># either load an object to update if obj_id is given</span>
    <span class="c"># else initiate a new object, this will be helpfull</span>
    <span class="c"># when we want to create a new object instead of just</span>
    <span class="c"># editing existing one</span>
    <span class="k">if</span> <span class="n">obj_id</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj_id</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

    <span class="n">ObjForm</span> <span class="o">=</span> <span class="n">model_form</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
    <span class="c"># populate the form with the request data</span>
    <span class="n">form</span> <span class="o">=</span> <span class="n">ObjForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
    <span class="c"># this actually populates the obj (the blog post)</span>
    <span class="c"># from the form, that we have populated from the request post</span>
    <span class="n">form</span><span class="o">.</span><span class="n">populate_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</pre></div>


<p>You should now be able to modify any existing blog post, easy right? :)</p>
<p>let's implement the <code class="yellow">/blog/new/</code> url,
actually we just need to register it in the url rule, and modify the get
method, we have already defined our post logic.</p>
<div class="highlight"><pre><span class="c"># project/app/admin/admin.py</span>

<span class="c"># to add the  operation url modify rules to look like this</span>
<span class="n">admin</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s">&#39;/blog/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;POST&#39;</span><span class="p">])</span>
<span class="n">admin</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s">&#39;/blog/&lt;operation&gt;/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
<span class="n">admin</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s">&#39;/blog/&lt;int:obj_id&gt;/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>
                    <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;POST&#39;</span><span class="p">])</span>



<span class="c"># CRUDView</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_id</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;new&#39;</span><span class="p">:</span>
        <span class="n">ObjForm</span> <span class="o">=</span> <span class="n">model_form</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="c">#  we just want an empty form</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ObjForm</span><span class="p">()</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">detail_template</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span>
                               <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">)</span>

    <span class="c"># ... rest of code omited</span>
</pre></div>


<p>You will be able to create a new Post by Clicking the <code class="highlight">Create new</code> button. :)</p>
<p>Every thing is working now except for the delete, which is very easy to
implement</p>
<div class="highlight"><pre><span class="c"># project/app/admin/admin.py</span>

<span class="n">admin</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s">&#39;/blog/&lt;operation&gt;/&lt;int:obj_id&gt;/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>
                   <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>

<span class="c"># CRUDView</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_id</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;delete&#39;</span><span class="p">:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj_id</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="c"># ... rest of code omited</span>
</pre></div>


<p>And that's all there is to it :) ... ok maybe there is a couple of
issues we haven't looked at that we can easly implement.</p>
<div class="highlight"><pre>&quot;exclude&quot; fields from the form.
&quot;decorate&quot; our view with for example &#39;auth&#39; decorator and so on.
&quot;filter&quot; list view base on a given model query.
</pre></div>


<p>To exclude some fields we just supply an iterator as an argument
axclude.</p>
<p>Let's first define two helper methods list and detail to render our
views and change the code slighty to keep things DRY(don't repeat
yourself).</p>
<div class="highlight"><pre><span class="c"># this is the resulting CRUDVew</span>



<span class="k">class</span> <span class="nc">CRUDView</span><span class="p">(</span><span class="n">MethodView</span><span class="p">):</span>
    <span class="n">list_template</span> <span class="o">=</span> <span class="s">&#39;admin/listview.html&#39;</span>
    <span class="n">detail_template</span> <span class="o">=</span> <span class="s">&#39;admin/detailview.html&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">list_template</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">detail_template</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoint</span>
        <span class="c"># so we can generate a url relevant to this</span>
        <span class="c"># endpoint, for example if we utilize this CRUD object</span>
        <span class="c"># to enpoint comments the path generated will be</span>
        <span class="c"># /admin/comments/</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">url_for</span><span class="p">(</span><span class="s">&#39;.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">list_template</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_template</span> <span class="o">=</span> <span class="n">list_template</span>
        <span class="k">if</span> <span class="n">detail_template</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detail_template</span> <span class="o">=</span> <span class="n">detail_template</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ObjForm</span> <span class="o">=</span> <span class="n">model_form</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">render_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">detail_template</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_template</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_id</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;new&#39;</span><span class="p">:</span>
            <span class="c">#  we just want an empty form</span>
            <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ObjForm</span><span class="p">()</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_detail</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;delete&#39;</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj_id</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">obj_id</span><span class="p">:</span>
            <span class="c"># this creates the form fields base on the model</span>
            <span class="c"># so we don&#39;t have to do them one by one</span>
            <span class="n">ObjForm</span> <span class="o">=</span> <span class="n">model_form</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>

            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj_id</span><span class="p">)</span>
            <span class="c"># populate the form with our blog data</span>
            <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ObjForm</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
            <span class="c"># action is the url that we will later use</span>
            <span class="c"># to do post, the same url with obj_id in this case</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_detail</span><span class="p">(</span><span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">)</span>

        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">created_on</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_list</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_id</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="c"># either load and object to update if obj_id is given</span>
        <span class="c"># else initiate a new object, this will be helpfull</span>
        <span class="c"># when we want to create a new object instead of just</span>
        <span class="c"># editing existing one</span>
        <span class="k">if</span> <span class="n">obj_id</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">obj_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>

        <span class="n">ObjForm</span> <span class="o">=</span> <span class="n">model_form</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="c"># populate the form with the request data</span>
        <span class="n">form</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ObjForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">)</span>
        <span class="c"># this actually populates the obj (the blog post)</span>
        <span class="c"># from the form, that we have populated from the request post</span>
        <span class="n">form</span><span class="o">.</span><span class="n">populate_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</pre></div>


<p>To exclude something just supply a list of the fields you don't want
to the view creation, for example</p>
<div class="highlight"><pre><span class="n">view</span> <span class="o">=</span> <span class="n">CRUDView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s">&#39;blog&#39;</span><span class="p">,</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="s">&#39;blog&#39;</span><span class="p">,</span>
                        <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;created_on&#39;</span><span class="p">,</span> <span class="s">&#39;updated_on&#39;</span><span class="p">])</span>
</pre></div>


<p>For a decorator you could just wrap the view like this.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">dec</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;run decorator run&#39;</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">decorated</span>

<span class="n">view</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="n">CRUDView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s">&#39;blog&#39;</span><span class="p">,</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="s">&#39;blog&#39;</span><span class="p">]))</span>
</pre></div>


<p>But this is ugly, you won't have to do this after we create our
register_crud helper function as you soon shall see.</p>
<p>But for now Lets see how we can add filter.</p>
<div class="highlight"><pre><span class="c"># add argument to __init__</span>
<span class="n">filters</span><span class="o">=</span><span class="bp">None</span>

<span class="c"># and set the atribute filters</span>
<span class="bp">self</span><span class="o">.</span><span class="n">filters</span> <span class="o">=</span> <span class="n">filters</span> <span class="ow">or</span> <span class="p">{}</span>

<span class="c"># modify get</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_id</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">filter_name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="c">#....</span>

    <span class="c"># list view with filter</span>
    <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s">&#39;filter&#39;</span><span class="p">:</span>
        <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filter_name</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_list</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">filter_name</span><span class="o">=</span><span class="n">filter_name</span><span class="p">)</span>

    <span class="c">#... rest of code ommited</span>

<span class="c"># add filters to render list</span>
<span class="k">def</span> <span class="nf">render_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_template</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                           <span class="n">filters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filters</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c"># add the rule</span>
<span class="n">admin</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s">&#39;/blog/&lt;operation&gt;/&lt;filter_name&gt;/&#39;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>
                    <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
</pre></div>


<p>The way that this works is that we add a dictionary of functions, to the
filter attribute, and then when we do a request we catch the filter name
and simply call it from the dictionary attribute and pass the model as
an argument, so we can always assume we have the model supplied to the
function,</p>
<p>from then on we simple do our query and return the object, which we will
display in the listview template.</p>
<p>So basicly we are just replacing the obj with the one returned by the
filter.</p>
<div class="highlight"><pre><span class="c">&lt;!-- listview.html --&gt;</span>

<span class="c">&lt;!-- template menu --&gt;</span>
<span class="c">&lt;!-- Add this  right bellow the Create New button  --&gt;</span>
{% if filters %}
    {% if not filter_name %}
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button button blue&quot;</span> <span class="na">href=</span><span class="s">&quot;{{path}}&quot;</span><span class="nt">&gt;</span>Show all<span class="nt">&lt;/a&gt;</span>
    {% else %}
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button&quot;</span> <span class="na">href=</span><span class="s">&quot;{{path}}&quot;</span><span class="nt">&gt;</span>Show all<span class="nt">&lt;/a&gt;</span>
    {% endif %}
{% endif %}

{% for filter in filters %}
    {% if filter == filter_name %}
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button button blue&quot;</span> <span class="na">href=</span><span class="s">&quot;{{path + &#39;filter/&#39; + filter}}&quot;</span><span class="nt">&gt;</span>{{filter.replace(&#39;_&#39;, &#39; &#39;)}}<span class="nt">&lt;/a&gt;</span>
    {% else %}
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button&quot;</span> <span class="na">href=</span><span class="s">&quot;{{path + &#39;filter/&#39; + filter}}&quot;</span><span class="nt">&gt;</span>{{filter.replace(&#39;_&#39;, &#39; &#39;)}}<span class="nt">&lt;/a&gt;</span>
    {% endif %}
{% endfor %}
</pre></div>


<p>We now have a nice button display of filters, let's see how we can set
some up :)</p>
<div class="highlight"><pre><span class="c"># admin.py</span>


<span class="n">blog_filters</span> <span class="o">=</span> <span class="p">{</span>
<span class="s">&#39;created_asc&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">created_on</span><span class="o">.</span><span class="n">asc</span><span class="p">()),</span>
<span class="s">&#39;updated_desc&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">updated_on</span><span class="o">.</span><span class="n">desc</span><span class="p">()),</span>
<span class="s">&#39;last_3&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">created_on</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">view</span> <span class="o">=</span> <span class="n">CRUDView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="s">&#39;blog&#39;</span><span class="p">,</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="s">&#39;blog&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">blog_filters</span><span class="p">)</span>
</pre></div>


<p>If you are not much familiar with lambda basicly it's just a syntactic
sugar to write a one line function, for example</p>
<div class="highlight"><pre><span class="s">&#39;created_asc&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">created_on</span><span class="o">.</span><span class="n">asc</span><span class="p">())</span>

<span class="c"># this is the same as the line above</span>
<span class="k">def</span> <span class="nf">created_asc_filter</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">created_on</span><span class="o">.</span><span class="n">asc</span><span class="p">())</span>

<span class="s">&#39;created_asc&#39;</span><span class="p">:</span> <span class="n">created_asc_filter</span>
</pre></div>


<p>That's it, browse to <code class="yellow">/admin/blog/</code> and see how nicely it displays the
filter menu :)</p>
<p>It is not so tidy to define all these urls for every model in our code,
let's define a helper functions that registers all these url for us, to
make the code more modular.</p>
<div class="highlight"><pre><span class="c"># admin.py</span>

<span class="c"># replace the view and url rules with this helper function</span>

<span class="k">def</span> <span class="nf">register_crud</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">decorators</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">view</span> <span class="o">=</span> <span class="n">CRUDView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span>
                            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">decorator</span> <span class="ow">in</span> <span class="n">decorators</span><span class="p">:</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">decorator</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>

    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/&#39;</span> <span class="o">%</span> <span class="n">url</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;POST&#39;</span><span class="p">])</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/&lt;int:obj_id&gt;/&#39;</span> <span class="o">%</span> <span class="n">url</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/&lt;operation&gt;/&#39;</span> <span class="o">%</span> <span class="n">url</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/&lt;operation&gt;/&lt;int:obj_id&gt;/&#39;</span> <span class="o">%</span> <span class="n">url</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>
                     <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/&lt;operation&gt;/&lt;filter_name&gt;/&#39;</span> <span class="o">%</span> <span class="n">url</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">view</span><span class="p">,</span>
                     <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">])</span>
</pre></div>


<p>To register a url to a model simply call the function like this.</p>
<div class="highlight"><pre><span class="n">register_crud</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span> <span class="s">&#39;/blog&#39;</span><span class="p">,</span> <span class="s">&#39;blog&#39;</span><span class="p">,</span> <span class="n">Blog</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">blog_filters</span><span class="p">)</span>
</pre></div>


<p>That was easy, right ?
What is more nice, is that we can do this to any model in the database.</p>
<p>Lets try adding comments to the database and see how we can display
them.</p>
<div class="highlight"><pre><span class="c"># project/app/admin/models.py</span>

<span class="c"># add this bellow our blog class model</span>

<span class="k">class</span> <span class="nc">Comment</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">blog_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;blog.id&#39;</span><span class="p">))</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s">&#39;Blog&#39;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">backref</span><span class="p">(</span><span class="s">&#39;comments&#39;</span><span class="p">,</span>
                                                      <span class="n">lazy</span><span class="o">=</span><span class="s">&#39;dynamic&#39;</span><span class="p">))</span>

    <span class="n">username</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">comment</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Text</span><span class="p">())</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">created_on</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">post</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">post</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blog</span> <span class="o">=</span> <span class="n">post</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&lt;Comment: blog {}, {}&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blog_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">[:</span><span class="mi">20</span><span class="p">])</span>
</pre></div>


<p>From the terminal in the project dir, do</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">db</span>

<span class="kn">from</span> <span class="nn">app.admin.models</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">db</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>
</pre></div>


<p>We have now created the comment table.
How do you think we can display it in the admin interface?</p>
<div class="highlight"><pre><span class="c"># admin.py</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Comment</span>

<span class="n">register_crud</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span> <span class="s">&#39;/comments&#39;</span><span class="p">,</span> <span class="s">&#39;comments&#39;</span><span class="p">,</span> <span class="n">Comment</span><span class="p">)</span>
</pre></div>


<p>That's it, head over to <code class="yellow">/admin/comments/</code> and will display a list of all
the comment.
It is empty, so hit the Create New and fill in some comment.</p>
<p>Create a Couple of filters.</p>
<div class="highlight"><pre><span class="n">comment_filters</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;invisible&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
        <span class="s">&#39;visible&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="p">}</span>

<span class="n">register_crud</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span> <span class="s">&#39;/comments&#39;</span><span class="p">,</span> <span class="s">&#39;comments&#39;</span><span class="p">,</span> <span class="n">Comment</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="n">comment_filters</span><span class="p">)</span>
</pre></div>


<p>As you can see you could easely extend this to tens of models.</p>
<p>To display a menu with with our model we need to define a base html and
let listview and detailview inherit from it, that would also allow us to
overide the default templates without much code.</p>
<p>Refactor templates to look like this.</p>
<p>Note, I am including the css in the html for simplicity sake, but they
should live on their own file.</p>
<div class="highlight"><pre><span class="c">&lt;!-- project/app/admin/templates/admin/admin.html --&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Admin<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;http://yui.yahooapis.com/pure/0.5.0/pure-min.css&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style&gt;</span>
        <span class="nc">.main</span> <span class="p">{</span>
          <span class="k">position</span><span class="o">:</span> <span class="k">relative</span><span class="p">;</span>
          <span class="k">width</span><span class="o">:</span> <span class="m">90%</span><span class="p">;</span>
          <span class="k">margin</span><span class="o">:</span> <span class="m">0</span> <span class="k">auto</span><span class="p">;</span>
          <span class="k">height</span><span class="o">:</span> <span class="k">inherit</span><span class="p">;</span>
         <span class="p">}</span>
        <span class="nc">.main</span> <span class="nc">.menu</span> <span class="nt">ul</span> <span class="p">{</span>
          <span class="k">width</span><span class="o">:</span> <span class="m">90%</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.main</span> <span class="nc">.menu</span> <span class="nt">ul</span> <span class="nt">li</span><span class="nd">:last-child</span> <span class="p">{</span>
          <span class="k">float</span><span class="o">:</span> <span class="k">right</span><span class="p">;</span>
          <span class="k">display</span><span class="o">:</span> <span class="k">inline</span><span class="o">-</span><span class="k">block</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nc">.button</span> <span class="p">{</span>
          <span class="k">color</span><span class="o">:</span> <span class="nb">white</span><span class="p">;</span>
          <span class="k">border</span><span class="o">-</span><span class="n">radius</span><span class="o">:</span> <span class="m">4px</span><span class="p">;</span>
          <span class="k">text-shadow</span><span class="o">:</span> <span class="m">0</span> <span class="m">1px</span> <span class="m">1px</span> <span class="n">rgba</span><span class="p">(</span><span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">,</span> <span class="m">0</span><span class="o">.</span><span class="m">2</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nc">.button.red</span> <span class="p">{</span>
          <span class="k">background</span><span class="o">:</span> <span class="m">#ca3c3c</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.button.blue</span> <span class="p">{</span>
          <span class="k">background</span><span class="o">:</span> <span class="m">#3caeca</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nc">.listview</span> <span class="o">&gt;</span> <span class="nt">a</span> <span class="p">{</span>
          <span class="k">margin</span><span class="o">:</span> <span class="m">10px</span> <span class="m">0</span> <span class="m">10px</span> <span class="m">20px</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.listview</span> <span class="nc">.pure-g</span> <span class="p">{</span>
          <span class="k">margin</span><span class="o">:</span> <span class="m">2px</span> <span class="k">auto</span><span class="p">;</span>
          <span class="k">padding</span><span class="o">:</span> <span class="m">10px</span> <span class="m">0</span> <span class="m">10px</span> <span class="m">20px</span><span class="p">;</span>
          <span class="k">background</span><span class="o">:</span> <span class="m">#f4f6ff</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.listview</span> <span class="nc">.pure-u</span> <span class="p">{</span>
          <span class="k">overflow</span><span class="o">:</span> <span class="k">hidden</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="p">{</span>
          <span class="k">width</span><span class="o">:</span> <span class="m">90%</span><span class="p">;</span>
          <span class="k">margin</span><span class="o">:</span> <span class="m">40px</span> <span class="k">auto</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">legend</span> <span class="p">{</span>
          <span class="k">color</span><span class="o">:</span> <span class="m">#6b6b6b</span><span class="p">;</span>
          <span class="k">font-size</span><span class="o">:</span> <span class="m">1.2em</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">label</span> <span class="p">{</span>
          <span class="k">margin-top</span><span class="o">:</span> <span class="m">30px</span><span class="p">;</span>
          <span class="k">color</span><span class="o">:</span> <span class="m">#a5a5a5</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">textarea</span> <span class="p">{</span>
          <span class="k">min-height</span><span class="o">:</span> <span class="m">200px</span><span class="p">;</span>
          <span class="k">padding</span><span class="o">:</span> <span class="m">10px</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">input</span><span class="o">,</span> <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">select</span><span class="o">,</span> <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">textarea</span> <span class="p">{</span>
          <span class="k">width</span><span class="o">:</span> <span class="m">100%</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="s2">&quot;checkbox&quot;</span><span class="o">]</span> <span class="p">{</span>
          <span class="k">width</span><span class="o">:</span> <span class="m">50px</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nc">.item-form</span> <span class="nc">.pure-form</span> <span class="nt">button</span> <span class="p">{</span>
          <span class="k">margin</span><span class="o">:</span> <span class="m">30px</span> <span class="m">0</span><span class="p">;</span>
        <span class="p">}</span>


    <span class="nt">&lt;/style&gt;</span>

        {% block head %} {% endblock %}
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;menu pure-menu pure-menu-open pure-menu-horizontal&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/&quot;</span> <span class="na">class=</span><span class="s">&quot;pure-menu-heading&quot;</span><span class="nt">&gt;</span>Admin<span class="nt">&lt;/a&gt;</span>

            <span class="nt">&lt;ul&gt;</span>
                <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ url_for(&#39;admin.blog&#39;)}}&quot;</span><span class="nt">&gt;</span>Blog<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ url_for(&#39;admin.comments&#39;)}}&quot;</span><span class="nt">&gt;</span>Comments<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>
                <span class="nt">&lt;li&gt;&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button&quot;</span> <span class="na">href=</span><span class="s">&quot;#not_implemented&quot;</span><span class="nt">&gt;</span>Logout<span class="nt">&lt;/a&gt;&lt;/li&gt;</span>

            <span class="nt">&lt;/ul&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        {% block body %}

        {% endblock %}
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


<div class="highlight"><pre><span class="c">&lt;!-- project/app/admin/templates/admin/listview.html --&gt;</span>

{% extends &#39;admin/admin.html&#39; %}

{% block body %}

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;listview&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button pure-button-primary&quot;</span> <span class="na">href=</span><span class="s">&quot;{{path + &#39;new&#39;}}&quot;</span><span class="nt">&gt;</span>Create new<span class="nt">&lt;/a&gt;</span>
        {% if filters %}
            {% if not filter_name %}
                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button button blue&quot;</span> <span class="na">href=</span><span class="s">&quot;{{path}}&quot;</span><span class="nt">&gt;</span>Show all<span class="nt">&lt;/a&gt;</span>
            {% else %}
                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button&quot;</span> <span class="na">href=</span><span class="s">&quot;{{path}}&quot;</span><span class="nt">&gt;</span>Show all<span class="nt">&lt;/a&gt;</span>
            {% endif %}
        {% endif %}

        {% for filter in filters %}
            {% if filter == filter_name %}
                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button button blue&quot;</span> <span class="na">href=</span><span class="s">&quot;{{path + &#39;filter/&#39; + filter}}&quot;</span><span class="nt">&gt;</span>{{filter.replace(&#39;_&#39;, &#39; &#39;)}}<span class="nt">&lt;/a&gt;</span>
            {% else %}
                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button&quot;</span> <span class="na">href=</span><span class="s">&quot;{{path + &#39;filter/&#39; + filter}}&quot;</span><span class="nt">&gt;</span>{{filter.replace(&#39;_&#39;, &#39; &#39;)}}<span class="nt">&lt;/a&gt;</span>
            {% endif %}
        {% endfor %}

        {% for item in obj %}
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;pure-g&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;pure-u-2-24&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button pure-button-primary button red&quot;</span> <span class="na">href=</span><span class="s">&quot;{{path +&#39;delete/&#39;+ item.id|string}}&quot;</span><span class="nt">&gt;</span>delete<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;pure-u&quot;</span><span class="nt">&gt;&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button pure-button-primary button blue&quot;</span> <span class="na">href=</span><span class="s">&quot;{{path + item.id|string}}&quot;</span><span class="nt">&gt;</span>{{item}}<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        {% endfor %}
    <span class="nt">&lt;/div&gt;</span>

{% endblock %}
</pre></div>


<div class="highlight"><pre><span class="c">&lt;!-- project/app/admin/templates/admin/detailview.html --&gt;</span>

{% extends &#39;admin/admin.html&#39; %}

{% block body %}

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;item-form&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">&quot;pure-form pure-form-stacked&quot;</span>
              <span class="na">action=</span><span class="s">&quot;{{action}}&quot;</span>
              <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>

            <span class="nt">&lt;fieldset&gt;</span>
                <span class="nt">&lt;legend&gt;</span>Item View<span class="nt">&lt;/legend&gt;</span>

                {% for field in form %}

                    {{field.label()}}
                    {{field(class=&quot;pure-input&quot;)}}

                {% endfor %}

                <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">class=</span><span class="s">&quot;pure-button pure-button-primary pure-input-1-4&quot;</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>

                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;pure-button pure-button-primary button red&quot;</span> <span class="na">href=</span><span class="s">&quot;{{ path +&#39;delete/&#39;+ action.split(&#39;/&#39;)[-2]}}&quot;</span><span class="nt">&gt;</span>delete<span class="nt">&lt;/a&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;/fieldset&gt;</span>

        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

{% endblock %}
</pre></div>


<p>The End...</p>
<p>Do you know of a better way to create a CRUD like the one we just did?</p>
<p>Why not leave a comment with your suggestions ?</p>
<p><a href="https://github.com/spaceexperiment/Code-for-CRUD-admin-tutorial">Link for the code
repository</a></p>
        </article>
    </div>

</section>
    </div>

       <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-53218124-1');ga('send','pageview');
        </script>
</body>
</html>